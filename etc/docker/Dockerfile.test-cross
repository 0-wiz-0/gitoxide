ARG TARGET

FROM ghcr.io/cross-rs/${TARGET}:latest

ARG TARGET

RUN set -uC && \
    apt_suffix= && \
    if target_arch="$(dpkg-architecture --host-type "$TARGET" --query DEB_HOST_ARCH)"; then \
        dpkg --add-architecture "$target_arch" && \
        apt_suffix=":$target_arch"; \
    fi && \
    apt-get update && \
    apt-get install --no-install-recommends -y software-properties-common && \
    add-apt-repository -y ppa:git-core/ppa && \
    apt-get update && \
    apt-get install --no-install-recommends -y "git$apt_suffix" jq patch && \
    apt-get purge --autoremove software-properties-common && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* && \
    if test -f /android-runner; then \
        sed -i.orig 's/^export LD_PRELOAD=/test "${NO_PRELOAD_CXX:-0}" != 0 || &/' \
            /android-runner; \
    fi && \
    git config --system gitoxide.imaginary.arbitraryVariable arbitraryValue
